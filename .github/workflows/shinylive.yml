name: build-shinylive

# -------------------------------------------------
# 1.  Run this workflow on every commit that you push
# -------------------------------------------------
on: [push]             #  <--  THIS line tells GitHub when to run

permissions:
  pages: write
  id-token: write

# -------------------------------------------------
# 2.  Build job – installs shinylive, creates dist/
# -------------------------------------------------
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2

      # Step 1 – install shinylive from CRAN
      - name: Install shinylive
        shell: Rscript {0}
        run: |
          options(repos = c(CRAN = "https://cloud.r-project.org"))
          install.packages("shinylive")

      # Step 2 – export the browser bundle
      - name: Build shinylive bundle
        shell: Rscript {0}
        run: shinylive::export(appdir = ".", destdir = "dist", include_assets = "www")

      # Step 3 – upload dist/ as a Pages artifact (v3 action)
      - uses: actions/upload-pages-artifact@v3
        with:
          path: dist

# -------------------------------------------------
# 3.  Deploy job – publishes the artifact to GitHub Pages
# -------------------------------------------------
  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
